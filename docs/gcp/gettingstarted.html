

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GCP Modes" href="gcp-modes.html" />
    <link rel="prev" title="Developer Guide" href="../azure/contribute.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/glossary.html">Basic concepts and terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aws/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/examples/index.html">Example Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/policy/index.html">Filters and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/policy/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/policy/mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/authentication.html#azure-storage-access">Azure Storage access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html#adding-new-azure-resources">Adding New Azure Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html#testing">Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-gcp-plugin">Install GCP Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#option-1-install-released-packages-to-local-python-environment">Option 1: Install released packages to local Python Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#option-2-install-latest-from-the-repository">Option 2: Install latest from the repository</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#connect-your-authentication-credentials">Connect Your Authentication Credentials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gcp-cli">GCP CLI:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#write-your-first-policy">Write Your First Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-your-policy">Run Your Policy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gcp-modes.html">GCP Modes</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="gcp-gettingstarted"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>The GCP provider plugin is an optional package which can be installed in addition to
the base Cloud Custodian application. It provides the ability to write policies which
interact with GCP related resources.</p>
<div class="section" id="install-gcp-plugin">
<span id="gcp-install-cc"></span><h2>Install GCP Plugin<a class="headerlink" href="#install-gcp-plugin" title="Permalink to this headline">¶</a></h2>
<p>First, ensure you have <a class="reference internal" href="../quickstart/index.html#install-cc"><span class="std std-ref">installed the base Cloud Custodian application</span></a>.
Cloud Custodian is a Python application that supports Python 2 and 3 on Linux and Windows.
We recommend using Python 3.6 or higher.</p>
<p>Once the base install is complete, you are now ready to install the GCP provider package
using one of the following options:</p>
<div class="section" id="option-1-install-released-packages-to-local-python-environment">
<h3>Option 1: Install released packages to local Python Environment<a class="headerlink" href="#option-1-install-released-packages-to-local-python-environment" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install c7n
$ pip install c7n_gcp
</pre></div>
</div>
</div>
<div class="section" id="option-2-install-latest-from-the-repository">
<h3>Option 2: Install latest from the repository<a class="headerlink" href="#option-2-install-latest-from-the-repository" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/cloud-custodian/cloud-custodian.git
$ pip install -e ./cloud-custodian
$ pip install -e ./cloud-custodian/tools/c7n_gcp
</pre></div>
</div>
</div>
</div>
<div class="section" id="connect-your-authentication-credentials">
<span id="gcp-authenticate"></span><h2>Connect Your Authentication Credentials<a class="headerlink" href="#connect-your-authentication-credentials" title="Permalink to this headline">¶</a></h2>
<p>In order for Custodian to be able to interact with your GCP resources, you will need to
configure your GCP authentication credentials on your system in a way in which the
application is able to retrieve them.</p>
<p>Choose from one of the following methods to configure your credentials, depending on your
use case. In either option, after the configuration is complete, Custodian will implicitly
pick up your credentials when it runs.</p>
<div class="section" id="gcp-cli">
<h3>GCP CLI:<a class="headerlink" href="#gcp-cli" title="Permalink to this headline">¶</a></h3>
<p>If you are a general user accessing a single account, then you can use the GCP CLI to
configure your credentials.</p>
<p>First, <a class="reference external" href="https://cloud.google.com/sdk/install">install</a> <code class="docutils literal notranslate"><span class="pre">gcloud</span></code> (the GCP Command Line Interface).</p>
<p>Then run the following command, substituting your username:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud auth application-default login &lt;your_user_name&gt;
</pre></div>
</div>
<p>Executing the command will open a browser window with prompts to finish configuring
your credentials. For more information on this command,
<a class="reference external" href="https://cloud.google.com/sdk/gcloud/reference/auth/login">view its documentation</a>.</p>
</div>
<div class="section" id="environment-variables">
<h3>Environment Variables:<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>If you are planning to run Custodian using a service account, then configure your credentials
using environment variables.</p>
<p>Follow the steps outlined in the
<a class="reference external" href="https://cloud.google.com/docs/authentication/getting-started">GCP documentation to configure credentials for service accounts.</a></p>
</div>
</div>
<div class="section" id="write-your-first-policy">
<span id="gcp-write-policy"></span><h2>Write Your First Policy<a class="headerlink" href="#write-your-first-policy" title="Permalink to this headline">¶</a></h2>
<p>A policy is the primary way that Custodian is configured to manage cloud resources.
It is a YAML file that follows a predetermined schema to describe what you want
Custodian to do.</p>
<p>There are three main components to a policy:</p>
<ul class="simple">
<li><p>Resource: the type of resource to run the policy against</p></li>
<li><p>Filters: criteria to produce a specific subset of resources</p></li>
<li><p>Actions: directives to take on the filtered set of resources</p></li>
</ul>
<p>In the example below, we will write a policy that filters for compute engine
resources, and then stops each resource.</p>
<p>Filename: <code class="docutils literal notranslate"><span class="pre">custodian.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy</span>
    <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">Stops all compute instances that contain the word &quot;test&quot;</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcp.instance</span>
    <span class="nt">filters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
        <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
        <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
        <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">in</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>
</pre></div>
</div>
</div>
<div class="section" id="run-your-policy">
<span id="gcp-run-policy"></span><h2>Run Your Policy<a class="headerlink" href="#run-your-policy" title="Permalink to this headline">¶</a></h2>
<p>First, ensure you have <a class="reference internal" href="#gcp-authenticate"><span class="std std-ref">configured one of the supported authentication mechanisms</span></a>.</p>
<p>Next, run the following command to execute the policy with Custodian:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>custodian run --output-dir<span class="o">=</span>. custodian.yml
</pre></div>
</div>
<p>If successful, you should see output similar to the following on the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">06</span><span class="p">,</span><span class="mi">133</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">Running</span> <span class="n">policy</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span> <span class="n">gcp</span><span class="o">.</span><span class="n">instance</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">07</span><span class="p">,</span><span class="mi">514</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span> <span class="n">gcp</span><span class="o">.</span><span class="n">instance</span> <span class="n">has</span> <span class="n">count</span><span class="p">:</span><span class="mi">3</span> <span class="n">time</span><span class="p">:</span><span class="mf">1.38</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span><span class="mi">188</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">action</span><span class="p">:</span> <span class="n">stop</span><span class="p">:</span> <span class="mi">3</span> <span class="n">execution_time</span><span class="p">:</span> <span class="mf">0.67</span>
</pre></div>
</div>
<p>You should also find a new <code class="docutils literal notranslate"><span class="pre">my-first-policy</span></code> directory with a log and other
files (subsequent runs will append to the log by default, rather than
overwriting it).</p>
<p>See <a class="reference internal" href="../filters.html#filters"><span class="std std-ref">Generic Filters</span></a> for more information on the features of the Value filter used in this sample.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gcp-modes.html" class="btn btn-neutral float-right" title="GCP Modes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../azure/contribute.html" class="btn btn-neutral float-left" title="Developer Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>