

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generic Filters &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/c1_labs.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/js/expand.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Generic Actions" href="actions.html" />
    <link rel="prev" title="Getting Started" href="quickstart/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generic Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#value-filter">Value Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#age-filter">Age Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-filter">Event Filter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview/glossary.html">Basic concepts and terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview/deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="aws/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/examples/index.html">Example Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/policy/index.html">Filters and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/policy/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws/policy/mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/authentication.html#azure-storage-access">Azure Storage access</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/contribute.html#adding-new-azure-resources">Adding New Azure Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure/contribute.html#testing">Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gcp/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcp/gcp-modes.html">GCP Modes</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Generic Filters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generic-filters">
<span id="filters"></span><h1>Generic Filters<a class="headerlink" href="#generic-filters" title="Permalink to this headline">¶</a></h1>
<p>The following filters can be applied to all policies for all resources. See the
<a class="reference internal" href="aws/policy/index.html#policy"><span class="std std-ref">Filters and Actions reference</span></a> for
aws resource-specific filters.</p>
<div class="section" id="value-filter">
<h2>Value Filter<a class="headerlink" href="#value-filter" title="Permalink to this headline">¶</a></h2>
<p>Cloud Custodian provides for a flexible query language on any resource by
allowing for rich queries on JSON objects via JMESPath, and allows for
mixing and combining those with boolean conditional operators that
are nest-able. (Tutorial here on <a class="reference external" href="http://jmespath.org/tutorial.html">JMESPath</a> syntax)</p>
<p>The base value filter enables the use of jmespath with data returned from a describe call.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
       <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;State[0]&quot;</span>    <span class="l l-Scalar l-Scalar-Plain">─▶ The value from the describe call</span>
       <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;running&quot;</span>   <span class="l l-Scalar l-Scalar-Plain">─▶ Value that is being filtered against</span>
</pre></div>
</div>
<p>There are several ways to get a list of possible keys for each resource.</p>
<ul>
<li><p>Via Custodian CLI</p>
<blockquote>
<div><p>Create a new custodian yaml file with just the name and resource fields. Then run
<code class="docutils literal notranslate"><span class="pre">custodian</span> <span class="pre">run</span> <span class="pre">-s</span> <span class="pre">OUTPUT_DIR</span></code>. The valid key fields can be found in the output directory
in resources.json</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws.ec2</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Via Cloud Providers CLI</p>
<blockquote>
<div><p>Use the relevant cloud provider cli to run the describe call to view all available keys. For example
using aws cli run <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">ec2</span> <span class="pre">describe-instances</span></code> or with azure <code class="docutils literal notranslate"><span class="pre">az</span> <span class="pre">vm</span> <span class="pre">list</span></code>.</p>
<p>Note: You do not need to include the outermost json field in most cases since custodian removes this field
from the results.</p>
</div></blockquote>
</li>
<li><p>Via Cloud Provider Documentation</p>
<blockquote>
<div><p>Go to the relevant cloud provider sdk documentation and search for the describe api call for the resource
you’re interested in. The available fields will be listed under the results of that api call.</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Comparison operators:</dt><dd><p>The generic value filter allows for comparison operators to be used</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">equal</span></code> or <code class="docutils literal notranslate"><span class="pre">eq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not-equal</span></code> or <code class="docutils literal notranslate"><span class="pre">ne</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater-than</span></code> or <code class="docutils literal notranslate"><span class="pre">gt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gte</span></code> or <code class="docutils literal notranslate"><span class="pre">ge</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less-than</span></code> or <code class="docutils literal notranslate"><span class="pre">lt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lte</span></code> or <code class="docutils literal notranslate"><span class="pre">le</span></code></p></li>
</ul>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
     <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CpuOptions.CoreCount      ─▶ The value from the describe call</span>
     <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">36                      ─▶ Value that is being compared</span>
     <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">greater-than               ─▶ Comparison Operator</span>
</pre></div>
</div>
</li>
<li><dl class="simple">
<dt>Other operators:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">absent</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">present</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not-null</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">empty</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contains</span></code></p></li>
</ul>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
     <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CpuOptions.CoreCount      ─▶ The value from the describe call</span>
     <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present                 ─▶ Checks if key is present</span>
</pre></div>
</div>
</li>
<li><dl class="simple">
<dt>Logical Operators:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">or</span></code> or <code class="docutils literal notranslate"><span class="pre">Or</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">and</span></code> or <code class="docutils literal notranslate"><span class="pre">And</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not</span></code></p></li>
</ul>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">or</span><span class="p">:</span>                              <span class="l l-Scalar l-Scalar-Plain">─▶ Logical Operator</span>
     <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
       <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CpuOptions.CoreCount      ─▶ The value from the describe call</span>
       <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">36                      ─▶ Value that is being compared</span>
     <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
       <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CpuOptions.CoreCount      ─▶ The value from the describe call</span>
       <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">42                      ─▶ Value that is being compared</span>
</pre></div>
</div>
</li>
<li><dl class="simple">
<dt>List Operators:</dt><dd><p>There is a collection of operators that can be used with user supplied lists. The operators
are evaluated as <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">from</span> <span class="pre">key</span></code> in (the operator) <code class="docutils literal notranslate"><span class="pre">given</span> <span class="pre">value</span></code>. If you would like it
evaluated in the opposite way  <code class="docutils literal notranslate"><span class="pre">given</span> <span class="pre">value</span></code> in (the operator) <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">from</span> <span class="pre">key</span></code> then you
can include the <code class="docutils literal notranslate"><span class="pre">swap</span></code> transformation or use the <code class="docutils literal notranslate"><span class="pre">contains</span></code> operator.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not-in</span></code> or <code class="docutils literal notranslate"><span class="pre">ni</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intersect</span></code> - Provides comparison between 2 lists</p></li>
</ul>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
     <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ImageId                   ─▶ The value from the describe call</span>
     <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">in                         ─▶ List operator</span>
     <span class="nt">value</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">ID-123</span><span class="p p-Indicator">,</span> <span class="nv">ID-321</span><span class="p p-Indicator">]</span>        <span class="l l-Scalar l-Scalar-Plain">─▶ List of Values to be compared against</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
     <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ImageId.List              ─▶ The value from the describe call</span>
     <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">in                         ─▶ List operator</span>
     <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ID-321                  ─▶ Values to be compared against</span>
     <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">swap               ─▶ Switches list comparison order</span>
</pre></div>
</div>
</li>
<li><dl class="simple">
<dt>Special operators:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">glob</span></code> - Provides Glob matching support</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regex</span></code> - Provides Regex matching support but ignores case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regex-case</span></code> - Provides case sensitive Regex matching support</p></li>
</ul>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
     <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FunctionName                ─▶ The value from the describe call</span>
     <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">regex                        ─▶ Special operator</span>
     <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">^(custodian?)\w+          ─▶ Regex string</span>
</pre></div>
</div>
</li>
<li><p>Transformations:
Transformations on the value can be done using the <code class="docutils literal notranslate"><span class="pre">value_type</span></code> keyword.  The
following value types are supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code> - convert to a datetime (for past date comparisons)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cidr</span></code> - parse an ipaddress</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cidr_size</span></code> - the length of the network prefix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expiration</span></code> - convert to a datetime (for future date comparisons)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">integer</span></code> - convert the value to an integer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize</span></code> - convert the value to lowercase</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_count</span></code> - compare against the number of matched resources</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code> - the length of an element</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">swap</span></code> - swap the value and the evaluated key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">date</span></code> - parse the filter’s value as a date.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the size of a group</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SecurityGroups[].GroupId</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">size</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>

<span class="c1"># Membership example using swap</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SecurityGroups[].GroupId</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">swap</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">in</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sg-49b87f44</span>

<span class="c1"># Convert to integer before comparison</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tag:Count</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">greater-than</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="c1"># Apply only to rds instances created after the given date</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">InstanceCreateTime</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">greater-than</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">date</span>
  <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;2019/05/01&quot;</span>

<span class="c1"># Find instances launched within the last 31 days</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LaunchTime</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">less-than</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">age</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>

<span class="c1"># Use `resource_count` to filter resources based on the number that matched</span>
<span class="c1"># Note that no `key` is used for this value_type since it is matching on</span>
<span class="c1"># the size of the list of resources and not a specific field.</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">resource_count</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lt</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>

 <span class="c1"># This policy will use `intersect` op to compare rds instances subnet group list</span>
 <span class="c1"># against a user provided list of public subnets from a s3 txt file.</span>
<span class=" -Error"> </span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">find-rds-on-public-subnets-using-s3-list</span>
   <span class="nt">comment</span><span class="p">:</span>  <span class="p p-Indicator">|</span>
      <span class="no">The txt file needs to be in utf-8 no BOM format and contain one</span>
      <span class="no">subnet per line in the file no quotes around the subnets either.</span>
   <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws.rds</span>
   <span class="nt">filters</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
         <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;DBSubnetGroup.Subnets[].SubnetIdentifier&quot;</span>
         <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">intersect</span>
         <span class="nt">value_from</span><span class="p">:</span>
             <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3://cloud-custodian-bucket/PublicSubnets.txt</span>
             <span class="nt">format</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">txt</span>

<span class="c1"># This policy will compare rds instances subnet group list against a</span>
<span class="c1"># inline user provided list of public subnets.</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">find-rds-on-public-subnets-using-inline-list</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws.rds</span>
  <span class="nt">filters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
        <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;DBSubnetGroup.Subnets[].SubnetIdentifier&quot;</span>
        <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">intersect</span>
        <span class="nt">value</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">subnet-2a8374658</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">subnet-1b8474522</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">subnet-2d2736444</span>
</pre></div>
</div>
</li>
<li><p>Value Regex:</p>
<p>When using a Value Filter, a <code class="docutils literal notranslate"><span class="pre">value_regex</span></code> can be
specified. This will mean that the value used for comparison is the output
from evaluating a regex on the value found on a resource using <cite>key</cite>.</p>
<p>The filter expects that there will be exactly one capturing group, however
non-capturing groups can be specified as well, e.g. <code class="docutils literal notranslate"><span class="pre">(?:newkey|oldkey)</span></code>.</p>
<p>Note that if the value regex does not find a match, it will return a <code class="docutils literal notranslate"><span class="pre">None</span></code>
value.</p>
<p>In this example there is an <code class="docutils literal notranslate"><span class="pre">expiration</span></code> comparison,
which needs a datetime, however the tag containing this information
also has other data in it. By setting the <code class="docutils literal notranslate"><span class="pre">value_regex</span></code>
to capture just the datetime part of the tag, the filter can be evaluated
as normal.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find expiry from tag contents</span>
<span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
  <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;tag:metadata&quot;</span>
  <span class="nt">value_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">expiration</span>
  <span class="nt">value_regex</span><span class="p">:</span> <span class="s">&quot;.*delete_after=([0-9]{4}-[0-9]{2}-[0-9]{2}).*&quot;</span>
  <span class="nt">op</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">less-than</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="age-filter">
<h2>Age Filter<a class="headerlink" href="#age-filter" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Automatically filter resources older than a given date in Days (see <a class="reference external" href="http://dateutil.readthedocs.org/en/latest/parser.html#dateutil.parser.parse">Dateutil Parser</a>)
These are implemented on a per resource basis. See the <a class="reference internal" href="aws/policy/index.html#policy"><span class="std std-ref">Resource-Specific Filters and Actions reference</span></a> for
resource-specific filters.</p>
<p>Generally you should use a value filter instead of an age filter, as it supports doing age/expiration comparisons on
any date attribute.</p>
</div></blockquote>
</div>
<div class="section" id="event-filter">
<h2>Event Filter<a class="headerlink" href="#event-filter" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Filter against a CloudWatch event JSON associated to a resource type. The list of possible keys are now from the cloudtrail
event and not the describe resource call as is the case in the ValueFilter</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no-ec2-public-ips</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws.ec2</span>
  <span class="nt">mode</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
    <span class="nt">events</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>
  <span class="nt">filters</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">event                                                                           ─┐ The key is a JMESPath Query of</span>
      <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;detail.requestParameters.networkInterfaceSet.items[].associatePublicIpAddress&quot;</span>   <span class="l l-Scalar l-Scalar-Plain">├▶the event JSON from CloudWatch</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true                                                                           ─┘</span>
  <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">terminate</span>
      <span class="nt">force</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="actions.html" class="btn btn-neutral float-right" title="Generic Actions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart/index.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>