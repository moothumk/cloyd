

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Monitoring your environment &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lambda Support" href="policy/lambda.html" />
    <link rel="prev" title="AWS Modes" href="aws-modes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/glossary.html">Basic concepts and terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Example Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy/index.html">Filters and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Monitoring your environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloudwatch-logs">CloudWatch Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#s3-logs-records">S3 Logs &amp; Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reports">Reports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="policy/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy/mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/authentication.html#azure-storage-access">Azure Storage access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html#adding-new-azure-resources">Adding New Azure Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html#testing">Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gcp/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/gcp-modes.html">GCP Modes</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Monitoring your environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="monitoring-your-environment">
<span id="usage"></span><h1>Monitoring your environment<a class="headerlink" href="#monitoring-your-environment" title="Permalink to this headline">¶</a></h1>
<p>Cloud Custodian generates a consistent set of outputs for any given
policy.</p>
<p>Custodian automatically generates per policy outputs with resources metrics
and archives serialization for all resources that match against a policy’s
filters.</p>
<p>TODO: figure out where “Custodian Dashboards in CloudWatch” page goes –
here? its own page? part of Getting Started?</p>
<div class="section" id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>By default Cloud Custodian generates CloudWatch metrics on each policy for
the number of resources that matched the set of filters,
the time to retrieve and filter the resources, and the time to
execute actions.</p>
<p>In practice this number of matching resources allows for generating
enough metrics to put together useful dashboards over policies
in CloudWatch custom dashboards.</p>
<p>Additionally some filters and actions may generate their own metrics.</p>
<p>In order to enable metrics output, the boolean metrics
flag needs to be specified when running Cloud Custodian:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics-enabled aws &lt;policyfile&gt;.yml
</pre></div>
</div>
<p>You can also consolidate metrics into a single account by specifying the <code class="docutils literal notranslate"><span class="pre">master</span></code>
location in the cli. Note that this is only applicable when using the <code class="docutils literal notranslate"><span class="pre">--assume</span></code> option
in the cli or when using c7n-org. By default, metrics will be sent to the same account
that is being executed against:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics-enabled aws://master
</pre></div>
</div>
<p>Additionally, to use a different namespace other than the default <code class="docutils literal notranslate"><span class="pre">CloudMaid</span></code>, you can
add the following query parameter to the metrics flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics-enabled aws://?namespace=foo
</pre></div>
</div>
<p>This will create a new namespace, <code class="docutils literal notranslate"><span class="pre">foo</span></code> in CloudWatch Metrics. You can also combine
these two options to emit metrics into a custom namespace in a central account:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics-enabled aws://master?namespace=foo
</pre></div>
</div>
<p>Finally, to send metrics to a specific region, use the <code class="docutils literal notranslate"><span class="pre">region</span></code> query parameter to
specify a region:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics-enabled aws://?region=us-west-2
</pre></div>
</div>
<p>When running the metrics in a centralized account or when centralizing to a specific
region, additional account and region dimensions will be included.</p>
</div>
<div class="section" id="cloudwatch-logs">
<h2>CloudWatch Logs<a class="headerlink" href="#cloudwatch-logs" title="Permalink to this headline">¶</a></h2>
<p>Custodian can optionally upload its logs in realtime to CloudWatch logs, if
a log group is specified. Each policy’s log output is generated as a
separate stream.</p>
<p>Usage example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run --log-group=/cloud-custodian/&lt;dev-account&gt;/&lt;region&gt; &lt;policyfile&gt;.yml
</pre></div>
</div>
<p>If enabled, it is recommended to set a log subscription on the group to
be informed of an operations issue.</p>
<p>If S3 output is also enabled, then it is also recommended to set a log group
archival policy and to use the S3 logs as permanent/audit archive.</p>
</div>
<div class="section" id="s3-logs-records">
<h2>S3 Logs &amp; Records<a class="headerlink" href="#s3-logs-records" title="Permalink to this headline">¶</a></h2>
<p>Custodian will output its logs and structured resource records in JSON format to S3, along
with its log files for archival purposes.</p>
<p>The S3 bucket and prefix can be specified via parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run --output-dir s3://&lt;my-bucket&gt;/&lt;my-prefix&gt; &lt;policyfile&gt;.yml
</pre></div>
</div>
</div>
<div class="section" id="reports">
<h2>Reports<a class="headerlink" href="#reports" title="Permalink to this headline">¶</a></h2>
<p>CSV or text-based reports can be generated with the <code class="docutils literal notranslate"><span class="pre">report</span></code> subcommand.</p>
<p>Reporting is used to list information gathered during previous calls to the <code class="docutils literal notranslate"><span class="pre">run</span></code>
subcommand.  If your goal is to find out what resources match on a policy use <code class="docutils literal notranslate"><span class="pre">run</span></code>
along with the <code class="docutils literal notranslate"><span class="pre">--dryrun</span></code> option.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="policy/lambda.html" class="btn btn-neutral float-right" title="Lambda Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="aws-modes.html" class="btn btn-neutral float-left" title="AWS Modes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>